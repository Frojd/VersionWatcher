service: versionwatcher

provider:
    name: aws
    runtime: nodejs4.3
    profile: versionwatcher
    stage: stage
    region: eu-west-1

functions:
    trackWp:
        handler: trackers.wp
        description: Track Wordpress dependencies
        events:
            - http:
                path: tracker/wp
                method: post
    trackNode:
        handler: trackers.node
        description: Track Node.js dependencies
        events:
            - http:
                path: tracker/node
                method: post

    stableHandler:
        handler: result.stableHandler
        description: Perform queries on the stable releases
        events:
            - http:
                path: tracker/stable
                method: get
resources:
  Resources:
    DynamoDBIamPolicy:
      Type: AWS::IAM::Policy
      Properties:
        PolicyName: lambda-dynamodb
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
            - Effect: Allow
              Action:
                - dynamodb:PutItem
              Resource:
                - arn:aws:dynamodb:*:*:table/VersionWatcher
                - arn:aws:dynamodb:*:*:table/VersionWatcherStable
        Roles:
          - Ref: IamRoleLambdaExecution
